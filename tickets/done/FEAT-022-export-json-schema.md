# FEAT-022: Export to JSON Schema

## 1. Intent (Required)

**User Story:**
As a developer
I want to export my DataCert profile as a JSON Schema
So that I can use it for data validation in any JSON Schema-compatible tool

**Success Looks Like:**
User can download a valid JSON Schema document that reflects the profiled data structure, usable with any JSON Schema validator.

## 2. Context & Constraints (Required)

**Background:**
JSON Schema is a universal standard for describing JSON data structures. Unlike framework-specific formats (GX, Soda), JSON Schema works with any language and many validation tools. This provides maximum portability for users who don't use specific data quality frameworks.

**Scope:**
- **In Scope:** JSON Schema Draft 2020-12 export, type mapping, required fields
- **Out of Scope:** JSON Schema validation UI, custom keywords, schema composition

**Constraints:**
- Must produce valid JSON Schema Draft 2020-12
- Must correctly map DataCert types to JSON Schema types
- Required array should contain columns with 0% null values

## 3. Acceptance Criteria (Required)

**Scenario: Export profile to JSON Schema**
```gherkin
Given I have profiled a CSV file with columns "id" (Integer), "name" (String), "amount" (Numeric)
When I click "Export" and select "JSON Schema"
Then a JSON file downloads
And $schema equals "https://json-schema.org/draft/2020-12/schema"
And type equals "object"
And properties.id.type equals "integer"
And properties.name.type equals "string"
And properties.amount.type equals "number"
```

**Scenario: Required fields based on null rate**
```gherkin
Given I have profiled a file with column "id" having 0% nulls
And column "optional_field" having 10% nulls
When I export to JSON Schema
Then required array contains "id"
And required array does not contain "optional_field"
```

**Scenario: Numeric constraints**
```gherkin
Given I have a numeric column with min=0 and max=100
When I export to JSON Schema
Then properties.column.minimum equals 0
And properties.column.maximum equals 100
```

**Scenario: String constraints**
```gherkin
Given I have a string column with minLength=5 and maxLength=50 detected
When I export to JSON Schema
Then properties.column.minLength equals 5
And properties.column.maxLength equals 50
```

## 4. AI Execution Instructions (Required)

**Files to Create:**
- `src/app/utils/exportJsonSchema.ts`

**Files to Modify:**
- `src/app/utils/exportReport.ts` (integrate new format)

**Allowed to Change:**
- Export utilities
- Type mapping logic

**Must NOT Change:**
- ProfileResult data structure
- Existing export formats

**Ambiguity Rule:**
If unclear, acceptance criteria override all other sections.

## 5. Planned Git Commit Message(s) (Required)

- `feat(export): add JSON Schema export`

## 6. Verification & Definition of Done (Required)

- [ ] Acceptance criteria pass
- [ ] Exported JSON Schema validates with online validator
- [ ] All DataCert types correctly mapped
- [ ] Required fields based on null rate
- [ ] Numeric bounds included when available
- [ ] Unit tests for export function
- [ ] Code reviewed

## 7. Dependencies

- None (can start immediately)

## 8. Technical Notes

**Type Mapping:**

| DataCert Type | JSON Schema Type | Additional Constraints |
|---------------|------------------|------------------------|
| Integer | `"integer"` | `minimum`, `maximum` |
| Numeric | `"number"` | `minimum`, `maximum` |
| String | `"string"` | `minLength`, `maxLength` |
| Boolean | `"boolean"` | - |
| Date | `"string"` | `format: "date"` |
| DateTime | `"string"` | `format: "date-time"` |
| Mixed | `["string", "number", "boolean", "null"]` | - |
| Empty | `"null"` | - |

**JSON Schema Structure:**

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "datacert-generated-schema",
  "title": "data.csv",
  "description": "Schema generated by DataCert",
  "type": "object",
  "properties": {
    "id": {
      "type": "integer",
      "minimum": 1,
      "maximum": 10000
    },
    "name": {
      "type": "string",
      "minLength": 1,
      "maxLength": 100
    }
  },
  "required": ["id"]
}
```

## 9. Resources

- [JSON Schema Specification](https://json-schema.org/draft/2020-12/schema)
- [Understanding JSON Schema](https://json-schema.org/understanding-json-schema/)
