# FEAT-023: Export to Soda Checks YAML

## 1. Intent (Required)

**User Story:**
As a data engineer
I want to export my DataCert profile as Soda Checks YAML
So that I can run data quality checks using Soda Core

**Success Looks Like:**
User can download a valid SodaCL YAML file that runs successfully with `soda scan` command against their data source.

## 2. Context & Constraints (Required)

**Background:**
Soda Core is a popular open-source data quality tool that uses SodaCL (Soda Checks Language) YAML files to define data quality checks. By exporting DataCert profiles as Soda checks, users can immediately integrate profiling insights into their Soda monitoring pipelines.

**Scope:**
- **In Scope:** SodaCL YAML export, tolerance configuration, warn/fail thresholds
- **Out of Scope:** Custom SQL checks, Soda Cloud integration, data source configuration

**Constraints:**
- Must produce valid SodaCL YAML syntax
- Must include configurable warn/fail thresholds
- User must provide dataset name for the checks

## 3. Acceptance Criteria (Required)

**Scenario: Export profile to Soda Checks**
```gherkin
Given I have profiled a CSV file
When I click "Export" and select "Soda Checks YAML"
And I enter dataset name "my_table"
Then a YAML file downloads
And it contains "checks for my_table:" header
And it contains checks for missing values
And it contains checks for numeric bounds (with configured tolerance)
```

**Scenario: Null checks generation**
```gherkin
Given I have a column with 5% null values
When I export with 10% tolerance
Then the check reads "missing_percent(column) < 15"
```

**Scenario: Numeric range checks**
```gherkin
Given I have a numeric column with min=100 and max=1000
When I export with 10% tolerance
Then check reads "min(column) >= 90"
And check reads "max(column) <= 1100"
```

**Scenario: Uniqueness checks**
```gherkin
Given I have a column where distinctCount equals totalRows
When I export to Soda Checks
Then check reads "duplicate_count(column) = 0"
```

## 4. AI Execution Instructions (Required)

**Files to Create:**
- `src/app/utils/exportSodaChecks.ts`

**Files to Modify:**
- `src/app/utils/exportReport.ts` (integrate new format)

**Allowed to Change:**
- Export utilities
- YAML generation logic

**Must NOT Change:**
- ProfileResult data structure
- Existing export formats

**Ambiguity Rule:**
If unclear, acceptance criteria override all other sections.

## 5. Planned Git Commit Message(s) (Required)

- `feat(export): add Soda Checks YAML export`

## 6. Verification & Definition of Done (Required)

- [ ] Acceptance criteria pass
- [ ] Exported YAML parses correctly
- [ ] Checks syntax matches SodaCL specification
- [ ] Tolerance configuration works for numeric bounds
- [ ] Unit tests for export function
- [ ] Code reviewed

## 7. Dependencies

- **SPIKE-007:** Research Soda Checks YAML Format (must complete first)
- **FEAT-024:** Export Format Selector UI (UI integration)

## 8. Technical Notes

**Check Mapping:**

| DataCert Metric | Soda Check |
|-----------------|------------|
| nullPercentage | `missing_percent(col) < X` |
| distinctCount == totalRows | `duplicate_count(col) = 0` |
| min | `min(col) >= X` |
| max | `max(col) <= X` |
| mean | `avg(col) between (X, Y)` |

**SodaCL Output Structure:**

```yaml
# Generated by DataCert
# Source: data.csv
# Tolerance: 10%

checks for my_table:
  # Column: id
  - missing_count(id) = 0
  - duplicate_count(id) = 0

  # Column: amount
  - missing_percent(amount) < 5
  - min(amount) >= 90
  - max(amount) <= 1100
  - avg(amount) between 450 and 550

  # Column: status
  - missing_percent(status) < 10
```

**Warn vs Fail:**

Optionally support warn thresholds:

```yaml
checks for my_table:
  - missing_percent(amount):
      fail: when > 10
      warn: when > 5
```

## 9. Resources

- [Soda SodaCL Documentation](https://docs.soda.io/soda-cl/soda-cl-overview.html)
- [SodaCL Metrics and Checks](https://docs.soda.io/soda-cl/metrics-and-checks.html)
